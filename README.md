# IR Remote Control для Home Assistant

Интеграция для управления умными пультами ИК через Zigbee.

## Описание

IR Remote Control позволяет Управлять умными Zigbee ИК-пультами. Разрабатывалось для пульта Tuya TS1201. 

### Основные возможности

- **Мультирум поддержка** - можно настроить несколько пультов для разных комнат
- **Обучение команд** - легко добавлять новые команды с оригинальных пультов
- **Удобные кнопки** - каждая команда становится кнопкой в Home Assistant
- **Сервисы** - программное управление через автоматизации
- **Мультиязычность** - поддержка русского и английского языков

## Требования

- **Home Assistant** 2023.1 или выше
- **ZHA интеграция** - пульт должен быть добавлен через ZHA.
- **ZHA Toolkit** - дополнительная интеграция ([установка](https://github.com/mdeweerd/zha-toolkit))
- **ИК-передатчик** - Zigbee умный пульт, желательно Tuya TS1201.

### Совместимые устройства

Интеграция работает с ZHA устройствами, поддерживающими ИК-передачу:

#### Проверенные модели:
- **TS1201** (Tuya) - Endpoint: 1, Cluster: e004 (57348)
- **Другие Tuya ИК-пульты** - обычно те же параметры, тк это версии того же пульта.
- **Xiaomi ИК-контроллеры** - надо проверить номера кластера.

#### Как проверить совместимость:

1. **Откройте ZHA** → **Устройства**
2. **Найдите ваше устройство**
3. **Нажмите "Управление устройством Zigbee"**
4. **Ищите кластеры** с командами типа:
   - `IRSend` или `SendIR`
   - `IRLearn` или `LearnIR`
   - Кластер типа `IRControl`

> **Важно**: Если в списке кластеров есть команды для ИК-управления, устройство должно работать с интеграцией.

## Установка

### Через HACS (рекомендуется)

1. Убедитесь, что [HACS](https://hacs.xyz/) установлен
2. Перейдите в HACS → Интеграции
3. Нажмите "+" и найдите "IR Remote Control". (Добавьте этот репозиторий через три точки наверху)
4. Нажмите "Скачать"
5. Перезапустите Home Assistant

### Ручная установка

1. Скачайте последнюю версию из [Releases](https://github.com/Maxiark/ir_remote_control_HA/releases)
2. Распакуйте архив в папку `custom_components/ir_remote/`
3. Перезапустите Home Assistant

## Настройка

### Шаг 1: Добавление интеграции

1. Перейдите в **Настройки** → **Устройства и службы**
2. Нажмите **"+ Добавить интеграцию"**
3. Найдите **"IR Remote Control"**
4. Выберите **"Добавить новый ИК-пульт"**

### Шаг 2: Настройка пульта

1. **Выберите ZHA устройство** - ваш ИК-передатчик из списка
2. **Укажите комнату** - например, "Гостиная", "Спальня"
3. **Настройте параметры**:
   - Endpoint ID: `1` (для большинства устройств)
   - Cluster ID: `57348` (для стандартных Tuya пультов)

#### Как найти правильные Endpoint ID и Cluster ID

Если стандартные значения не работают, найдите правильные параметры для вашего устройства:

1. **Перейдите в ZHA** → **Устройства**
2. **Найдите ваш ИК-пульт** (например, TS1201)
3. **Откройте страницу устройства**
4. **Нажмите три точки** справа от кнопки "Перенастроить"
5. **Выберите "Управление устройством Zigbee"**
6. **Найдите кластер** с командами `IRSend` и `IRLearn`
   - Ищите кластер типа `IRControl` (например, `ZosungIRControl` для TS1201)
7. **Запишите значения**:
   - **Endpoint**: обычно `1`
   - **ID**: например, `e004` (в HEX формате)
8. **Переведите ID из HEX в DEC**:
   - `e004` (HEX) = `57348` (DEC)
   - Используйте онлайн-конвертер или калькулятор

> **Совет**: Если не уверены в параметрах, сначала попробуйте стандартные значения. Если не работают, найдите точные параметры через ZHA.

### Шаг 3: Добавление устройств

1. Перейдите в **Настройки** → **Устройства и службы**
2. Найдите свою интеграцию **IR Remote Control**
3. Нажмите **"Настроить"**
4. Выберите **"Добавить виртуальное устройство"**
5. Укажите к какому умному пульту оно будет относиться
6. Укажите название устройства (например, "Телевизор Samsung")

### Шаг 4: Обучение команд

1. В настройках интеграции выберите **"Добавить команду к устройству"**
2. Выберите нужное устройство
3. Введите название команды (например, "Включить", "Громче")
4. Нажмите **"Продолжить"** после окна инструкции.
5. Нажмите нужную кнопку на оригинальном пульте, направляя его на умный пульт.
6. Команда автоматически сохранится и добавится кнопкой в виртуальное устройство в течение минуты.

## Использование

### Кнопки в интерфейсе

После настройки у вас появятся:
- **Виртуальные устройства** для каждого добавленного устройства
- **Кнопки команд** для каждой выученной команды
- **Кнопка "Добавить команду"** для обучения новых команд

### Автоматизации (не тестировались, предполагаемые функции)

Используйте кнопки или сервисы интеграции в автоматизациях:

```yaml
# Включить телевизор
service: ir_remote.send_command
data:
  controller_id: "ваш_id_контроллера"
  device: "телевизор"
  command: "включить"
```

## Доступные сервисы

| Сервис | Описание |
|--------|----------|
| `ir_remote.send_command` | Отправить команду по имени |
| `ir_remote.send_code` | Отправить ИК-код напрямую |
| `ir_remote.learn_command` | Обучить новую команду |
| `ir_remote.add_device` | Добавить устройство |
| `ir_remote.add_command` | Добавить готовую команду |
| `ir_remote.get_data` | Получить данные пультов |

## Примеры использования

### Автоматизация "Вечерний режим"

```yaml
automation:
  - alias: "Вечерний режим"
    trigger:
      - platform: sun
        event: sunset
    action:
      - service: ir_remote.send_command
        data:
          controller_id: "гостиная_пульт"
          device: "телевизор"
          command: "включить"
      - service: ir_remote.send_command
        data:
          controller_id: "гостиная_пульт"
          device: "кондиционер"
          command: "включить"
```

### Скрипт для управления громкостью

```yaml
script:
  tv_volume_up:
    sequence:
      - service: ir_remote.send_command
        data:
          controller_id: "гостиная_пульт"
          device: "телевизор"
          command: "громче"
  
  tv_volume_down:
    sequence:
      - service: ir_remote.send_command
        data:
          controller_id: "гостиная_пульт"
          device: "телевизор"
          command: "тише"
```

## Поиск и устранение неисправностей

### Проблема: Устройство не обучается

1. **Проверьте параметры Endpoint ID и Cluster ID**:
   - Убедитесь, что используете правильные значения для вашего устройства
   - Найдите точные параметры через ZHA → Управление устройством Zigbee
   - Переведите Cluster ID из HEX в DEC формат
2. Убедитесь, что ИК-пульт направлен на обучаемое устройство
3. Нажимайте кнопку на оригинальном пульте сразу после "Готов к обучению"
4. Проверьте, что ZHA Toolkit установлен и работает
5. Убедитесь, что ваше ZHA устройство поддерживает ИК-передачу
6. Проверьте ошибки в журнале.

### Проблема: ZHA устройство не найдено

1. Проверьте, что ZHA интеграция настроена
2. Убедитесь, что устройство подключено к ZHA
3. Установите ZHA Toolkit, если не установлен

### Проблема: Команды не работают

1. Проверьте логи Home Assistant на наличие ошибок
2. Убедитесь, что устройство находится в зоне действия ИК-сигнала
3. Попробуйте переобучить команду
4. Проверьте правильность Endpoint ID и Cluster ID

### Проблема: Неправильный Cluster ID

Если команды не отправляются или обучение не работает:

1. **Симптомы**: Ошибки в логах, команды не выполняются
2. **Решение**: Найдите правильный Cluster ID через ZHA
3. **Удалите и заново добавьте** интеграцию с правильными параметрами

## Логи и отладка

Для включения детальных логов добавьте в `configuration.yaml`:

```yaml
logger:
  default: info
  logs:
    custom_components.ir_remote: debug
```

## Поддержка

- 🐛 **Баги и предложения**: [GitHub Issues](https://github.com/Maxiark/ir_remote_control_HA/issues)
- 📝 **Обсуждения**: [GitHub Discussions](https://github.com/Maxiark/ir_remote_control_HA/discussions)
- 📖 **Документация**: [Wiki](https://github.com/Maxiark/ir_remote_control_HA/wiki)

### Помощь с новыми устройствами

**Если ваше устройство не работает:**

1. **Создайте Issue** с информацией:
   - Модель устройства
   - Скриншот из ZHA → Управление устройством Zigbee
   - Список доступных кластеров
   - Endpoint ID и Cluster ID которые вы нашли
2. **Мы поможем** настроить интеграцию для вашего устройства
3. **Обновим документацию** с новыми совместимыми устройствами

## Лицензия

MIT License - смотрите файл [LICENSE](LICENSE) для подробностей.

## Благодарности

- Сообщество Home Assistant за отличную платформу
- Разработчики ZHA и ZHA Toolkit
- Все участники, которые тестировали и улучшали интеграцию

---

⭐ **Если интеграция была полезна, поставьте звезду на GitHub!**